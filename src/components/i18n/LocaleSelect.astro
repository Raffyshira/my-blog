---
import {
  getLocalePaths,
  LOCALES,
} from "../../i18n.ts";
---


<div>
  <select id="lang" class="flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-2 py-1 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 " data-languageSelect>
    {
    getLocalePaths(Astro.url).map(({
      path, lang
    }) => (
      <option
        label= { LOCALES[lang].label }
        value= { path }
        data-lang= { lang }
        selected= { lang === Astro.currentLocale }
        dir= { LOCALES[lang].dir || null }
        />
    ))
    }
  </select>
</div>

<script is:inline>
  document.querySelectorAll("[data-languageSelect]").forEach((select) => {
    select.addEventListener("change", (event) => {
      const selectedOption = event.target?.selectedOptions[0];
      const selectedLang = selectedOption.dataset.lang;
      const newPath = selectedOption.value;

      // Gunakan URL API untuk memanipulasi URL dengan benar
      const url = new URL(window.location.href);
      url.pathname = newPath;

      // Simpan bahasa yang dipilih di localStorage
      localStorage.selectedLang = selectedLang;

      // Alihkan ke URL baru
      location.href = url.href;
    });
  });
</script>